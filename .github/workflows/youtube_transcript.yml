name: YouTube Transcript - yt-dlp

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'YouTube Video URL'
        required: true
        type: string

jobs:
  transcript:
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Install yt-dlp
        run: |
          pip install yt-dlp --break-system-packages
      
      - name: Extract Transcript
        env:
          VIDEO_URL: ${{ inputs.video_url }}
        run: |
          echo "ðŸ“¹ Processing: $VIDEO_URL"
          
          # Extract video info
          yt-dlp --print title --print channel --print duration "$VIDEO_URL" > /tmp/video_info.txt
          
          # Extract subtitles (try auto-generated if manual not available)
          yt-dlp --write-auto-subs --sub-lang en --skip-download --convert-subs txt -o "/tmp/transcript" "$VIDEO_URL" || \
          yt-dlp --write-subs --sub-lang en --skip-download --convert-subs txt -o "/tmp/transcript" "$VIDEO_URL"
          
          # Format output
          cat > transcript_output.txt << 'HEADER'
YouTube Video Transcript
================================================================================

HEADER
          
          echo "Title: $(sed -n '1p' /tmp/video_info.txt)" >> transcript_output.txt
          echo "Channel: $(sed -n '2p' /tmp/video_info.txt)" >> transcript_output.txt
          echo "Duration: $(sed -n '3p' /tmp/video_info.txt)" >> transcript_output.txt
          echo "URL: $VIDEO_URL" >> transcript_output.txt
          echo "Method: yt-dlp (FREE)" >> transcript_output.txt
          echo "" >> transcript_output.txt
          echo "================================================================================" >> transcript_output.txt
          echo "" >> transcript_output.txt
          
          # Append transcript
          if [ -f /tmp/transcript.en.txt ]; then
              cat /tmp/transcript.en.txt >> transcript_output.txt
          else
              echo "âŒ No transcript file found" >&2
              ls -la /tmp/*.txt
              exit 1
          fi
          
          echo "âœ… SUCCESS!"
          echo "ðŸ“Š Transcript length: $(wc -c < transcript_output.txt) bytes"
          echo ""
          echo "ðŸ“„ Preview:"
          head -50 transcript_output.txt
      
      - name: Upload Transcript
        uses: actions/upload-artifact@v4
        with:
          name: youtube-transcript
          path: transcript_output.txt
