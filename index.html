<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life OS - Shapira Family Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --purple: #8b5cf6; --blue: #3b82f6; --green: #10b981; --orange: #f59e0b; --red: #ef4444; }
        body { background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0f172a 100%); min-height: 100vh; font-family: system-ui, -apple-system, sans-serif; }
        .glass { background: rgba(30, 30, 50, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(139, 92, 246, 0.2); }
        .glow { box-shadow: 0 0 25px rgba(139, 92, 246, 0.3); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .score-ring { background: conic-gradient(from 0deg, var(--color) var(--percent), rgba(255,255,255,0.1) var(--percent)); }
    </style>
</head>
<body class="text-gray-100">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="glass rounded-2xl p-5 mb-6 glow">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="text-5xl">üß†</div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            Life OS - Shapira Family
                        </h1>
                        <p class="text-gray-400 text-sm mt-1">ADHD Focus Tracking ‚Ä¢ Claude Performance Monitor</p>
                    </div>
                </div>
                <div class="text-right">
                    <div id="current-date" class="text-lg font-semibold text-purple-400"></div>
                    <div id="current-time" class="text-2xl font-mono text-white"></div>
                    <div class="text-xs text-gray-500">üïê FL: EST | IL: IST</div>
                </div>
            </div>
        </div>

        <!-- Dual Score Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Ariel's Focus Score -->
            <div id="focus-score-card" class="glass rounded-2xl p-6 border border-purple-500/30">
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-2xl">üë§</span>
                    <h2 class="text-lg font-semibold text-purple-400">Ariel's Focus Score</h2>
                </div>
                <div class="flex items-center gap-6">
                    <div class="relative">
                        <div id="ariel-score-ring" class="w-24 h-24 rounded-full flex items-center justify-center" style="--color: #8b5cf6; --percent: 0%;">
                            <div class="w-20 h-20 rounded-full bg-gray-900 flex flex-col items-center justify-center">
                                <span id="ariel-score" class="text-2xl font-bold text-white">--</span>
                                <span class="text-xs text-gray-400">/ 100</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1">
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="ariel-tasks" class="text-lg font-bold text-green-400">--</div>
                                <div class="text-xs text-gray-500">Tasks Done</div>
                            </div>
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="ariel-abandoned" class="text-lg font-bold text-red-400">--</div>
                                <div class="text-xs text-gray-500">Abandoned</div>
                            </div>
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="ariel-rate" class="text-lg font-bold text-blue-400">--%</div>
                                <div class="text-xs text-gray-500">Rate</div>
                            </div>
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="ariel-focus" class="text-lg font-bold text-purple-400">--</div>
                                <div class="text-xs text-gray-500">Focus</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="ariel-insight" class="mt-4 pt-3 border-t border-gray-700/50 text-sm text-gray-400">
                    Loading...
                </div>
            </div>

            <!-- Claude's Performance Score -->
            <div id="claude-score-card" class="glass rounded-2xl p-6 border border-blue-500/30">
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-2xl">ü§ñ</span>
                    <h2 class="text-lg font-semibold text-blue-400">Claude's Performance</h2>
                </div>
                <div class="flex items-center gap-6">
                    <div class="relative">
                        <div id="claude-score-ring" class="w-24 h-24 rounded-full flex items-center justify-center" style="--color: #3b82f6; --percent: 0%;">
                            <div class="w-20 h-20 rounded-full bg-gray-900 flex flex-col items-center justify-center">
                                <span id="claude-score" class="text-2xl font-bold text-white">--</span>
                                <span class="text-xs text-gray-400">/ 100</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1">
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="claude-tools" class="text-lg font-bold text-green-400">--</div>
                                <div class="text-xs text-gray-500">Tool Calls</div>
                            </div>
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="claude-files" class="text-lg font-bold text-orange-400">--</div>
                                <div class="text-xs text-gray-500">Files</div>
                            </div>
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="claude-commits" class="text-lg font-bold text-purple-400">--</div>
                                <div class="text-xs text-gray-500">Commits</div>
                            </div>
                            <div class="glass rounded-lg p-2 text-center">
                                <div id="claude-errors" class="text-lg font-bold text-red-400">--</div>
                                <div class="text-xs text-gray-500">Errors</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="claude-insight" class="mt-4 pt-3 border-t border-gray-700/50 text-sm text-gray-400">
                    Loading...
                </div>
            </div>
        </div>

        <!-- Weekly Trend Chart -->
        <div class="glass rounded-2xl p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-300 mb-4">üìà Weekly Focus Trend</h2>
            <div style="height: 200px;">
                <canvas id="weeklyChart"></canvas>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="glass rounded-2xl p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-300 mb-4">üìã Recent Insights</h2>
            <div id="recent-insights" class="space-y-3">
                <div class="text-gray-500">Loading...</div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-600 text-xs mt-8">
            Life OS v4.0 ‚Ä¢ Created by Ariel Shapira ‚Ä¢ Powered by Claude AI
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://mocerqjnksmhcjzxrewo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vY2VycWpua3NtaGNqenhyZXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MzI1MjYsImV4cCI6MjA4MDEwODUyNn0.ySFJIOngWWB0aqYra4PoGFuqcbdHOx1ZV6T9-klKQDw';
        const headers = { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' };

        // Update time
        function updateTime() {
            const now = new Date();
            const optDate = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const optTime = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', optDate);
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', optTime);
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Set score ring
        function setScoreRing(elementId, score, color) {
            const el = document.getElementById(elementId);
            const percent = Math.min(100, Math.max(0, score));
            el.style.background = `conic-gradient(from 0deg, ${color} ${percent * 3.6}deg, rgba(255,255,255,0.1) ${percent * 3.6}deg)`;
        }

        // Load Ariel's Focus Data
        async function loadArielData() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const res = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?order=date.desc&limit=1`, { headers });
                const data = await res.json();
                
                if (data && data.length > 0) {
                    const d = data[0];
                    const score = d.productivity_score || 0;
                    document.getElementById('ariel-score').textContent = score;
                    document.getElementById('ariel-tasks').textContent = d.tasks_completed || 0;
                    document.getElementById('ariel-abandoned').textContent = d.tasks_abandoned || 0;
                    document.getElementById('ariel-rate').textContent = (d.completion_rate || 0) + '%';
                    document.getElementById('ariel-focus').textContent = (d.average_focus_quality || 0).toFixed(1);
                    setScoreRing('ariel-score-ring', score, score >= 80 ? '#10b981' : score >= 60 ? '#f59e0b' : '#ef4444');
                    document.getElementById('ariel-insight').textContent = d.session_recommendation || `Date: ${d.date}`;
                }
            } catch (e) {
                console.error('Error loading Ariel data:', e);
            }
        }

        // Load Claude's Performance Data
        async function loadClaudeData() {
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/insights?insight_type=eq.claude_performance&order=id.desc&limit=1`, { headers });
                const data = await res.json();
                
                if (data && data.length > 0) {
                    const d = data[0];
                    const desc = d.description || '';
                    
                    // Parse score from description
                    const scoreMatch = desc.match(/SCORE:\s*(\d+)/i);
                    const score = scoreMatch ? parseInt(scoreMatch[1]) : 0;
                    
                    // Parse metrics
                    const toolsMatch = desc.match(/TOOL CALLS:\s*(\d+)/i);
                    const filesMatch = desc.match(/FILES CREATED:\s*(\d+)/i);
                    const commitsMatch = desc.match(/(\d+)\s*GitHub commit/i);
                    const errorsMatch = desc.match(/(\d+)\s*error/i);
                    
                    document.getElementById('claude-score').textContent = score;
                    document.getElementById('claude-tools').textContent = toolsMatch ? toolsMatch[1] + '+' : '--';
                    document.getElementById('claude-files').textContent = filesMatch ? filesMatch[1] : '--';
                    document.getElementById('claude-commits').textContent = commitsMatch ? commitsMatch[1] : '--';
                    document.getElementById('claude-errors').textContent = errorsMatch ? errorsMatch[1] : '0';
                    setScoreRing('claude-score-ring', score, score >= 80 ? '#3b82f6' : score >= 60 ? '#f59e0b' : '#ef4444');
                    
                    // Get first achievement line
                    const achievements = desc.split('\n').filter(l => l.startsWith('‚úÖ')).slice(0, 2).join(' ‚Ä¢ ');
                    document.getElementById('claude-insight').textContent = achievements || d.title;
                } else {
                    document.getElementById('claude-insight').textContent = 'No performance data logged yet';
                }
            } catch (e) {
                console.error('Error loading Claude data:', e);
            }
        }

        // Load Weekly Chart
        async function loadWeeklyChart() {
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?order=date.desc&limit=7`, { headers });
                const data = await res.json();
                
                const labels = data.map(d => d.date.split('-').slice(1).join('/')).reverse();
                const scores = data.map(d => d.productivity_score || 0).reverse();
                
                const ctx = document.getElementById('weeklyChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Focus Score',
                            data: scores,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { min: 0, max: 100, grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#9ca3af' } },
                            x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                        }
                    }
                });
            } catch (e) {
                console.error('Error loading chart:', e);
            }
        }

        // Load Recent Insights
        async function loadInsights() {
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/insights?order=id.desc&limit=5`, { headers });
                const data = await res.json();
                
                const container = document.getElementById('recent-insights');
                if (data && data.length > 0) {
                    container.innerHTML = data.map(d => {
                        const icon = d.insight_type === 'claude_performance' ? 'ü§ñ' : 
                                     d.insight_type === 'daily_focus' ? 'üéØ' :
                                     d.insight_type === 'learning_session' ? 'üìö' :
                                     d.insight_type === 'deployment' ? 'üöÄ' : 'üí°';
                        return `<div class="flex items-start gap-3 p-3 rounded-lg bg-gray-800/50">
                            <span class="text-xl">${icon}</span>
                            <div>
                                <div class="font-medium text-gray-200">${d.title}</div>
                                <div class="text-xs text-gray-500">${d.insight_type} ‚Ä¢ ${d.related_date || 'Today'}</div>
                            </div>
                        </div>`;
                    }).join('');
                } else {
                    container.innerHTML = '<div class="text-gray-500">No insights yet</div>';
                }
            } catch (e) {
                console.error('Error loading insights:', e);
            }
        }

        // Initialize
        loadArielData();
        loadClaudeData();
        loadWeeklyChart();
        loadInsights();
        
        // Refresh every 30 seconds
        setInterval(() => {
            loadArielData();
            loadClaudeData();
            loadInsights();
        }, 30000);
    </script>
</body>
</html>
