<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life OS - Shapira Family Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --purple: #8b5cf6; --blue: #3b82f6; --green: #10b981; --orange: #f59e0b; --red: #ef4444; }
        body { background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0f172a 100%); min-height: 100vh; font-family: system-ui, -apple-system, sans-serif; }
        .glass { background: rgba(30, 30, 50, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(139, 92, 246, 0.2); }
        .glow { box-shadow: 0 0 25px rgba(139, 92, 246, 0.3); }
        .glow-green { box-shadow: 0 0 30px rgba(16, 185, 129, 0.4); }
        .glow-orange { box-shadow: 0 0 30px rgba(245, 158, 11, 0.4); }
        .glow-red { box-shadow: 0 0 30px rgba(239, 68, 68, 0.4); }
        .status-badge { padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .score-ring { background: conic-gradient(from 0deg, var(--ring-color) calc(var(--score) * 3.6deg), rgba(255,255,255,0.1) 0); border-radius: 50%; }
        .whatsapp-btn { background: #25D366; }
        .whatsapp-btn:hover { background: #128C7E; }
        .grade-badge { font-size: 1.5rem; font-weight: 800; }
    </style>
</head>
<body class="text-gray-100">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="glass rounded-2xl p-5 mb-6 glow">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="text-5xl">üß†</div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">Life OS - Shapira Family</h1>
                        <p class="text-gray-400 text-sm mt-1">FOCUS-Optimized Task Tracking ‚Ä¢ XGBoost ML Scoring</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="shareStatus()" class="whatsapp-btn text-white px-4 py-2 rounded-xl flex items-center gap-2 font-semibold">üì± Share</button>
                    <div class="text-right">
                        <div id="current-date" class="text-lg font-semibold text-purple-400"></div>
                        <div id="current-time" class="text-2xl font-mono text-white"></div>
                        <div class="text-xs text-gray-500">üïê FL: EST | IL: IST</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- XGBOOST FOCUS SCORE CARD -->
        <div id="focus-score-card" class="glass rounded-2xl p-6 mb-6 glow-green border border-green-500/30">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="flex items-center gap-6">
                    <div class="relative">
                        <div id="score-ring" class="w-32 h-32 score-ring flex items-center justify-center" style="--score: 78; --ring-color: #10b981;">
                            <div class="w-28 h-28 rounded-full bg-gray-900 flex flex-col items-center justify-center">
                                <span id="focus-score" class="text-4xl font-bold text-white">--</span>
                                <span class="text-xs text-gray-400">/ 100</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-400 uppercase tracking-wider">XGBoost Focus Score</div>
                        <div class="flex items-center gap-3 mt-1">
                            <span id="focus-grade-emoji" class="text-3xl">üèÜ</span>
                            <span id="focus-grade" class="grade-badge text-green-400">--</span>
                        </div>
                        <div id="focus-label" class="text-gray-400 mt-1">Loading...</div>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="glass rounded-lg p-3"><div id="feat-completion" class="text-xl font-bold text-green-400">--%</div><div class="text-xs text-gray-500">Completion</div></div>
                    <div class="glass rounded-lg p-3"><div id="feat-focus" class="text-xl font-bold text-blue-400">--</div><div class="text-xs text-gray-500">Focus Quality</div></div>
                    <div class="glass rounded-lg p-3"><div id="feat-switches" class="text-xl font-bold text-orange-400">--</div><div class="text-xs text-gray-500">Ctx Switches</div></div>
                    <div class="glass rounded-lg p-3"><div id="feat-streak" class="text-xl font-bold text-purple-400">--</div><div class="text-xs text-gray-500">Day Streak</div></div>
                </div>
                <div class="w-full md:w-48">
                    <div class="text-xs text-gray-400 mb-2 text-center">7-Day Trend</div>
                    <canvas id="trend-chart" height="60"></canvas>
                </div>
            </div>
            <div id="focus-insights" class="mt-4 pt-4 border-t border-gray-700/50">
                <div class="flex flex-wrap gap-2" id="insights-container"><span class="text-sm text-gray-400">Loading insights...</span></div>
            </div>
        </div>

        <!-- Focus Alert Banner -->
        <div id="focus-alert" class="glass rounded-xl p-4 mb-6 border-l-4 border-red-500 hidden">
            <div class="flex items-center gap-4">
                <div class="text-3xl pulse">‚ö†Ô∏è</div>
                <div><div class="font-semibold text-red-400">FOCUS INTERVENTION NEEDED</div><div id="alert-message" class="text-sm text-gray-400"></div></div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
            <div class="glass rounded-xl p-4 text-center"><div class="text-3xl font-bold text-white" id="stat-total">0</div><div class="text-xs text-gray-500 uppercase">Total Tasks</div></div>
            <div class="glass rounded-xl p-4 text-center"><div class="text-3xl font-bold text-green-400" id="stat-completed">0</div><div class="text-xs text-gray-500 uppercase">Completed</div></div>
            <div class="glass rounded-xl p-4 text-center"><div class="text-3xl font-bold text-blue-400" id="stat-progress">0</div><div class="text-xs text-gray-500 uppercase">In Progress</div></div>
            <div class="glass rounded-xl p-4 text-center"><div class="text-3xl font-bold text-orange-400" id="stat-pending">0</div><div class="text-xs text-gray-500 uppercase">Pending</div></div>
            <div class="glass rounded-xl p-4 text-center"><div class="text-3xl font-bold text-red-400" id="stat-interventions">0</div><div class="text-xs text-gray-500 uppercase">Open Alerts</div></div>
        </div>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="lg:col-span-2 glass rounded-xl p-5">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold flex items-center gap-2"><span>üìã</span> Today's Tasks</h2>
                    <div class="flex gap-2" id="domain-filters">
                        <button onclick="filterTasks('all')" class="px-3 py-1 rounded-lg bg-gray-700 text-xs hover:bg-gray-600">All</button>
                        <button onclick="filterTasks('BUSINESS')" class="px-3 py-1 rounded-lg bg-gray-800 text-xs hover:bg-gray-600">üíº</button>
                        <button onclick="filterTasks('FAMILY')" class="px-3 py-1 rounded-lg bg-gray-800 text-xs hover:bg-gray-600">üë®‚Äçüë©‚Äçüë¶</button>
                        <button onclick="filterTasks('MICHAEL')" class="px-3 py-1 rounded-lg bg-gray-800 text-xs hover:bg-gray-600">üèä</button>
                    </div>
                </div>
                <div id="tasks-list" class="space-y-3 max-h-96 overflow-y-auto"><div class="text-center text-gray-500 py-4">Loading tasks...</div></div>
            </div>
            <div class="space-y-6">
                <div class="glass rounded-xl p-5"><h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span>üß†</span> FOCUS Risk Monitor</h2><canvas id="risk-chart" height="200"></canvas></div>
                <div class="glass rounded-xl p-5"><h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span>‚ö†Ô∏è</span> Open Interventions</h2><div id="interventions-list" class="space-y-2 max-h-48 overflow-y-auto"><div class="text-center text-gray-500 py-4 text-sm">No open interventions ‚úÖ</div></div></div>
            </div>
        </div>

        <!-- Travel & Events Row -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="glass rounded-xl p-5 border-l-4 border-blue-500"><h2 class="text-lg font-semibold mb-3 flex items-center gap-2"><span>üöó</span> Active Trip</h2><div id="trip-details" class="text-sm"><div class="text-gray-500">No active trip</div></div></div>
            <div class="glass rounded-xl p-5 border-l-4 border-green-500"><h2 class="text-lg font-semibold mb-3 flex items-center gap-2"><span>üèä</span> Michael's Meet</h2><div id="swim-details" class="text-sm"><div class="text-gray-500">Loading...</div></div></div>
            <div class="glass rounded-xl p-5 border-l-4 border-purple-500"><h2 class="text-lg font-semibold mb-3 flex items-center gap-2"><span>üìä</span> Daily Metrics</h2>
                <div id="metrics-details" class="text-sm space-y-2">
                    <div class="flex justify-between"><span class="text-gray-400">Focus Quality</span><span id="metric-focus" class="text-white">--</span></div>
                    <div class="flex justify-between"><span class="text-gray-400">Completion Rate</span><span id="metric-completion" class="text-green-400">--%</span></div>
                    <div class="flex justify-between"><span class="text-gray-400">Context Switches</span><span id="metric-switches" class="text-orange-400">--</span></div>
                </div>
            </div>
        </div>

        <div class="text-center text-gray-500 text-xs"><p>Life OS v3.5 ‚Ä¢ XGBoost Focus Score ‚Ä¢ Created by Ariel Shapira ‚Ä¢ Auto-refreshes every 30s</p></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://mocerqjnksmhcjzxrewo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vY2VycWpua3NtaGNqenhyZXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MzI1MjYsImV4cCI6MjA4MDEwODUyNn0.ySFJIOngWWB0aqYra4PoGFuqcbdHOx1ZV6T9-klKQDw';
        const headers = { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' };
        let allTasks = [], currentFilter = 'all', riskChart = null, trendChart = null;

        const GRADES = [
            { min: 95, grade: 'A+', emoji: 'üèÜ', label: 'Elite Focus', color: '#10b981' },
            { min: 90, grade: 'A', emoji: 'üåü', label: 'Excellent', color: '#10b981' },
            { min: 85, grade: 'A-', emoji: '‚≠ê', label: 'Great', color: '#10b981' },
            { min: 80, grade: 'B+', emoji: 'üí™', label: 'Very Good', color: '#3b82f6' },
            { min: 75, grade: 'B', emoji: 'üëç', label: 'Good', color: '#3b82f6' },
            { min: 70, grade: 'B-', emoji: 'üìà', label: 'Above Average', color: '#3b82f6' },
            { min: 65, grade: 'C+', emoji: 'üîÑ', label: 'Average', color: '#f59e0b' },
            { min: 60, grade: 'C', emoji: 'üìä', label: 'Needs Work', color: '#f59e0b' },
            { min: 50, grade: 'C-', emoji: '‚ö†Ô∏è', label: 'Below Average', color: '#f59e0b' },
            { min: 40, grade: 'D', emoji: 'üîª', label: 'Poor', color: '#ef4444' },
            { min: 0, grade: 'F', emoji: '‚ùå', label: 'Critical', color: '#ef4444' },
        ];

        function getGrade(score) { return GRADES.find(g => score >= g.min) || GRADES[GRADES.length - 1]; }

        function updateTime() {
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        setInterval(updateTime, 1000); updateTime();

        function filterTasks(domain) { currentFilter = domain; renderTasks(); }

        function renderTasks() {
            const filtered = currentFilter === 'all' ? allTasks : allTasks.filter(t => t.domain === currentFilter);
            const container = document.getElementById('tasks-list');
            if (filtered.length === 0) { container.innerHTML = '<div class="text-center text-gray-500 py-4">No tasks</div>'; return; }
            const statusColors = { 'COMPLETED': 'bg-green-900/50 text-green-300', 'IN_PROGRESS': 'bg-blue-900/50 text-blue-300', 'INITIATED': 'bg-gray-700 text-gray-300', 'SOLUTION_PROVIDED': 'bg-purple-900/50 text-purple-300', 'ABANDONED': 'bg-red-900/50 text-red-300' };
            const statusIcons = { 'COMPLETED': '‚úÖ', 'IN_PROGRESS': 'üîÑ', 'INITIATED': '‚è≥', 'SOLUTION_PROVIDED': 'üí°', 'ABANDONED': '‚ùå' };
            const domainIcons = { 'BUSINESS': 'üíº', 'FAMILY': 'üë®‚Äçüë©‚Äçüë¶', 'MICHAEL': 'üèä', 'PERSONAL': 'üë§' };
            container.innerHTML = filtered.map(t => `<div class="p-3 bg-gray-800/50 rounded-lg border-l-2 ${t.status === 'IN_PROGRESS' ? 'border-blue-500' : 'border-gray-600'}"><div class="flex items-start justify-between gap-2"><div class="flex-1"><div class="flex items-center gap-2"><span>${statusIcons[t.status] || 'üìå'}</span><span>${domainIcons[t.domain] || 'üìå'}</span><span class="font-medium text-sm">${t.description?.substring(0, 50) || t.task_id}</span></div><div class="text-xs text-gray-500 mt-1">Complexity: ${t.complexity || '-'} | ${t.task_id}</div></div><span class="status-badge ${statusColors[t.status] || 'bg-gray-700'}">${t.status}</span></div></div>`).join('');
        }

        async function fetchFocusScore() {
            try {
                let scoreData = null;
                try {
                    const scoreRes = await fetch(`${SUPABASE_URL}/rest/v1/focus_scores?order=date.desc&limit=1`, { headers });
                    const scores = await scoreRes.json();
                    if (scores && scores.length > 0 && !scores.code) scoreData = scores[0];
                } catch (e) { console.log('focus_scores not available'); }

                if (!scoreData) {
                    const today = new Date().toISOString().split('T')[0];
                    const metricsRes = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?date=eq.${today}&limit=1`, { headers });
                    const metrics = await metricsRes.json();
                    if (metrics && metrics[0]) {
                        const m = metrics[0];
                        // Use XGBoost-calculated focus_score if available
                        if (m.focus_score !== null && m.focus_score !== undefined) {
                            const breakdown = typeof m.focus_breakdown === 'string' ? JSON.parse(m.focus_breakdown || '{}') : (m.focus_breakdown || {});
                            scoreData = {
                                score: m.focus_score,
                                grade: m.focus_grade || getGrade(m.focus_score).grade,
                                features: {
                                    completion_rate: m.completion_rate || 0,
                                    focus_quality: (m.average_focus_quality || 5) / 10,
                                    context_switches: Math.max(0, 1 - (m.context_switches || 0) / 15),
                                    streak_bonus: (m.productivity_streak || 0) / 7,
                                    ...breakdown
                                },
                                insights: breakdown.insights || []
                            };
                        } else {
                            // Fallback: calculate basic score if XGBoost not yet run
                            const completionRate = m.completion_rate || 0;
                            const focusQuality = (m.average_focus_quality || 5) / 10;
                            const switchScore = Math.max(0, 1 - (m.context_switches || 0) / 20);
                            const rawScore = (completionRate * 0.35 + focusQuality * 0.25 + switchScore * 0.20 + 0.20);
                            scoreData = { score: Math.min(100, Math.max(0, Math.round(rawScore * 100))), features: { completion_rate: completionRate, focus_quality: focusQuality, context_switches: switchScore }, insights: ['XGBoost score will calculate on next cron run'] };
                        }
                    }
                }

                if (scoreData) {
                    const score = scoreData.score || 0;
                    const gradeInfo = getGrade(score);
                    const features = typeof scoreData.features === 'string' ? JSON.parse(scoreData.features) : (scoreData.features || {});
                    const insights = typeof scoreData.insights === 'string' ? JSON.parse(scoreData.insights) : (scoreData.insights || []);

                    document.getElementById('focus-score').textContent = Math.round(score);
                    document.getElementById('focus-grade').textContent = gradeInfo.grade;
                    document.getElementById('focus-grade').style.color = gradeInfo.color;
                    document.getElementById('focus-grade-emoji').textContent = gradeInfo.emoji;
                    document.getElementById('focus-label').textContent = gradeInfo.label;

                    const ring = document.getElementById('score-ring');
                    ring.style.setProperty('--score', score);
                    ring.style.setProperty('--ring-color', gradeInfo.color);

                    const card = document.getElementById('focus-score-card');
                    card.classList.remove('glow-green', 'glow-orange', 'glow-red');
                    if (score >= 70) card.classList.add('glow-green');
                    else if (score >= 50) card.classList.add('glow-orange');
                    else card.classList.add('glow-red');
                    card.style.borderColor = gradeInfo.color + '50';

                    document.getElementById('feat-completion').textContent = Math.round((features.completion_rate || 0) * 100) + '%';
                    document.getElementById('feat-focus').textContent = Math.round((features.focus_quality || 0) * 10) + '/10';
                    document.getElementById('feat-switches').textContent = Math.round((1 - (features.context_switches || 0)) * 20);
                    document.getElementById('feat-streak').textContent = Math.round((features.streak_bonus || 0) * 7) + 'd';

                    const insightsContainer = document.getElementById('insights-container');
                    insightsContainer.innerHTML = insights.length > 0 ? insights.map(i => `<span class="px-3 py-1 bg-gray-800/70 rounded-full text-sm">${i}</span>`).join('') : '<span class="text-sm text-gray-400">Complete more tasks to unlock insights</span>';
                }

                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                try {
                    const trendRes = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?date=gte.${weekAgo}&select=date,focus_score&order=date.asc`, { headers });
                    const trendData = await trendRes.json();
                    if (trendData && Array.isArray(trendData) && trendData.length > 0 && trendData[0].focus_score !== undefined) {
                        updateTrendChart(trendData.map(d => ({ date: d.date, score: d.focus_score })));
                    }
                } catch (e) { console.log('Trend data not available'); }
            } catch (e) { console.error('Focus score error:', e); }
        }

        function updateTrendChart(data) {
            const ctx = document.getElementById('trend-chart');
            if (trendChart) trendChart.destroy();
            const labels = data.map(d => new Date(d.date).toLocaleDateString('en-US', { weekday: 'short' }));
            const scores = data.map(d => d.score);
            const colors = scores.map(s => getGrade(s).color);
            trendChart = new Chart(ctx, { type: 'line', data: { labels, datasets: [{ data: scores, borderColor: '#8b5cf6', backgroundColor: 'rgba(139, 92, 246, 0.1)', fill: true, tension: 0.4, pointRadius: 4, pointBackgroundColor: colors }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false, min: 0, max: 100 }, x: { display: true, ticks: { color: '#6b7280', font: { size: 9 } }, grid: { display: false } } } } });
        }

        async function fetchData() {
            try {
                const today = new Date().toISOString().split('T')[0];
                await fetchFocusScore();
                const tasksRes = await fetch(`${SUPABASE_URL}/rest/v1/task_states?select=*&order=initiated_at.desc`, { headers });
                allTasks = await tasksRes.json();
                const todayTasks = allTasks.filter(t => t.initiated_at?.startsWith(today));
                document.getElementById('stat-total').textContent = todayTasks.length;
                document.getElementById('stat-completed').textContent = todayTasks.filter(t => t.status === 'COMPLETED').length;
                document.getElementById('stat-progress').textContent = todayTasks.filter(t => t.status === 'IN_PROGRESS').length;
                document.getElementById('stat-pending').textContent = todayTasks.filter(t => ['INITIATED', 'SOLUTION_PROVIDED'].includes(t.status)).length;
                renderTasks();

                const intRes = await fetch(`${SUPABASE_URL}/rest/v1/task_interventions?successful=is.null&select=*&order=triggered_at.desc&limit=10`, { headers });
                const openInterventions = await intRes.json();
                document.getElementById('stat-interventions').textContent = openInterventions.length;
                const alertBanner = document.getElementById('focus-alert');
                const openHighRisk = openInterventions.find(i => i.intervention_level >= 3);
                if (openHighRisk) { alertBanner.classList.remove('hidden'); document.getElementById('alert-message').textContent = openHighRisk.message || 'High-risk task needs attention'; } else { alertBanner.classList.add('hidden'); }
                document.getElementById('interventions-list').innerHTML = openInterventions.length > 0 ? openInterventions.slice(0, 5).map(i => `<div class="p-2 bg-gray-800/50 rounded text-xs"><div class="flex items-center gap-2"><span class="${i.intervention_level >= 3 ? 'text-red-400' : i.intervention_level >= 2 ? 'text-orange-400' : 'text-yellow-400'}">${'‚ö†Ô∏è'.repeat(i.intervention_level || 1)}</span><span class="text-gray-300">${(i.task_description || i.task_id || 'Task').substring(0, 25)}</span></div><div class="text-gray-500 mt-1">${i.risk_level || ''} risk</div></div>`).join('') : '<div class="text-center text-green-400 py-2 text-sm">‚úÖ No open interventions</div>';

                updateRiskChart(todayTasks);

                const metricsRes = await fetch(`${SUPABASE_URL}/rest/v1/daily_metrics?date=eq.${today}&limit=1`, { headers });
                const metrics = await metricsRes.json();
                if (metrics[0]) {
                    document.getElementById('metric-focus').textContent = metrics[0].average_focus_quality || '--';
                    document.getElementById('metric-completion').textContent = Math.round((metrics[0].completion_rate || 0) * 100) + '%';
                    document.getElementById('metric-switches').textContent = metrics[0].context_switches || '0';
                }

                const travelRes = await fetch(`${SUPABASE_URL}/rest/v1/activities?activity_type=eq.DRIVING&platform=eq.life_os&limit=1&order=start_time.desc`, { headers });
                const travels = await travelRes.json();
                if (travels[0]) { try { const trip = JSON.parse(travels[0].notes || '{}'); document.getElementById('trip-details').innerHTML = `<div class="font-medium text-blue-400">${trip.title || 'Trip'}</div><div class="text-gray-400 mt-1">${trip.origin?.substring(0, 30) || ''} ‚Üí ${trip.destination || ''}</div>`; } catch(e) {} }

                const swimRes = await fetch(`${SUPABASE_URL}/rest/v1/activities?activity_type=eq.SWIM_MEET&platform=eq.life_os&limit=1&order=start_time.desc`, { headers });
                const swims = await swimRes.json();
                if (swims[0]) { try { const meet = JSON.parse(swims[0].notes || '{}'); document.getElementById('swim-details').innerHTML = `<div class="font-medium text-green-400">${meet.meet_name || 'Meet'}</div><div class="text-gray-400">${meet.location || ''}</div>`; } catch(e) {} }
            } catch(e) { console.error('Fetch error:', e); }
        }

        function updateRiskChart(tasks) {
            const ctx = document.getElementById('risk-chart');
            const domains = { BUSINESS: 0, FAMILY: 0, MICHAEL: 0, PERSONAL: 0 };
            tasks.forEach(t => { if (domains[t.domain] !== undefined) domains[t.domain]++; });
            if (riskChart) riskChart.destroy();
            riskChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Business', 'Family', 'Michael', 'Personal'], datasets: [{ data: [domains.BUSINESS, domains.FAMILY, domains.MICHAEL, domains.PERSONAL], backgroundColor: ['#f59e0b', '#10b981', '#3b82f6', '#8b5cf6'], borderWidth: 0 }] }, options: { plugins: { legend: { position: 'bottom', labels: { color: '#9ca3af', font: { size: 10 } } } }, cutout: '60%' } });
        }

        function shareStatus() {
            const score = document.getElementById('focus-score').textContent;
            const grade = document.getElementById('focus-grade').textContent;
            const completed = document.getElementById('stat-completed').textContent;
            const total = document.getElementById('stat-total').textContent;
            const msg = `üß† *Life OS Status Update*\nüìÖ ${new Date().toLocaleDateString()}\n\nüéØ Focus Score: ${score}/100 (${grade})\n‚úÖ ${completed}/${total} tasks completed\n\nüîó https://shapira-life-os.vercel.app`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        console.log("Life OS v3.5 + XGBoost Focus Score loaded"); fetchData(); setInterval(fetchData, 30000);
    </script>
</body>
</html>
